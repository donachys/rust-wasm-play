<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Simple template</title>
  </head>
  <body>
    <button onclick="Module.exports.clickme_clicked()">Click me</button>
    <script>
        window.Module = {};

        function ffiCString(p) {
          const stringBuffer = new Uint8Array(Module.memory.buffer, p);
          let s = '';
          for (let i = 0; i < stringBuffer.length && stringBuffer[i] != 0; i++) {
            s += String.fromCharCode(stringBuffer[i]);
          }
          return s;
        }

        const imports = {
          env: {
            alert: function(ptr) {
              alert(ffiCString(ptr));
            },
            log: function(ptr) {
              console.log(ffiCString(ptr));
            }
          }
        };

        fetch('fractals.wasm').then(response =>
          response.arrayBuffer()
        ).then(bytes =>
          WebAssembly.instantiate(bytes, imports)
        ).then(function(results) {
          Module.memory = results.instance.exports.memory;
          Module.exports = results.instance.exports;

          console.log('example()', Module.exports.example());

          const offset = Module.exports.hello();
          console.log(ffiCString(offset));

          Module.exports.call_js();
        });
    </script>
  </body>
</html>

